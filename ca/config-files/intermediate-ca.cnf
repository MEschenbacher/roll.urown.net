#
# OpenSSL configuration for the Intermediate Certification Authority.
#

# This definition doesn't work if HOME isn't defined.
CA_HOME         = .
RANDFILE        = $ENV::HOME/private/.rnd
oid_section     = new_oids


# XMPP address Support
[ new_oids ]
xmppAddr        = 1.3.6.1.5.5.7.8.5
SRVName         = 1.3.6.1.5.5.7.8.7


# Default Certification Authority
[ ca ]
default_ca      = intermediate_ca


# Intermediate Certification Authority
[ intermediate_ca ]
dir             = $ENV::HOME
certs           = $dir/certs
serial          = $dir/serial
database        = $dir/index
new_certs_dir   = $dir/newcerts
certificate     = $dir/ExampleNet_IntermediateCA.crt
private_key     = $dir/private/ExampleNet_IntermediateCA.key
crl             = $dir/ExampleNet_IntermediateCA.crl
crl_dir         = $dir/crl
crlnumber       = $dir/crlnumber
name_opt        = ca_default
cert_opt        = ca_default
copy_extensions = copy
crl_extensions  = crl_ext
default_crl_days= 30
default_md      = sha256
preserve        = no
email_in_dn     = no
policy          = dnPolicy


# Distinguished Name Policy
[ policy ]
countryName             = optional
stateOrProvinceName     = optional
localityName            = optional
organizationName        = optional
organizationalUnitName  = optional
commonName              = supplied
emailAddress            = optional
id-on-xmppAddr          = optional


# Request options (used by the intermediate CA for its own CSR)
[ req ]
default_bits        = 3072
default_keyfile     = private/ExampleNet_IntermediateCA.key
encrypt_key         = yes
default_md          = sha256
string_mask         = utf8only
utf8                = yes
prompt              = no
req_extensions      = req_ext
distinguished_name  = distinguished_name
subjectAltName      = subject_alt_name


# Request Extensions (used by the root and intermediate CA for its own CSR)
[ req_ext ]
basicConstraints        = critical, CA:true, pathlen:0
keyUsage                = critical, keyCertSign, cRLSign
subjectKeyIdentifier    = hash
subjectAltName          = @subject_alt_name


# Distinguished Name (DN)
[ distinguished_name ]
organizationName        = example.com
commonName              = Intermediate Certification Authority
emailAddress            = certmaster@example.com


# CRL Certificate Extensions
[ crl_ext ]
authorityKeyIdentifier  = keyid:always
issuerAltName           = issuer:copy


# Server Certificate Extensions
[ server_ext]
basicConstraints        = CA:FALSE
keyUsage                = critical, digitalSignature, keyEncipherment, keyAgreement
extendedKeyUsage        = critical, serverAuth, clientAuth
subjectKeyIdentifier    = hash
authorityKeyIdentifier  = keyid:always
issuerAltName           = issuer:copy
authorityInfoAccess     = @info_access
crlDistributionPoints   = crl_dist


# Client Certificate Extensions
[ client_ext]
basicConstraints        = CA:FALSE
keyUsage                = critical, digitalSignature. keyEncipherment
extendedKeyUsage        = critical, clientAuth
subjectKeyIdentifier    = hash
authorityKeyIdentifier  = keyid:always
issuerAltName           = issuer:copy
authorityInfoAccess     = @info_access
crlDistributionPoints   = crl_dist


# User Certificate Extensions
[ user_ext]
basicConstraints        = CA:FALSE
keyUsage                = critical, digitalSignature, keyEncipherment, dataEncipherment 
extendedKeyUsage        = critical, clientAuth, emailProtection
subjectKeyIdentifier    = hash
authorityKeyIdentifier  = keyid:always
issuerAltName           = issuer:copy
authorityInfoAccess     = @info_access
crlDistributionPoints   = crl_dist


# Certificate Authorities Alternative Names
[ subject_alt_name]
URI                     = http://ca.example.com/
email                   = certmaster@example.com


# CRL Download address for the intermediate CA
[ crl_dist ]
fullname                = URI:http://ca.example.com/crl/ExampleNet_IntermediateCA.crl


# Certificate download addresses for the intermediate CA
[ info_access ]
#OCSP;URI                = http://ocsp.example.com/inter_ocsp
caIssuers;URI           = http://ca.example.com/certs/ExampleNet_IntermediateCA.crt
# EOF