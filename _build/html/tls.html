

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TLS - Transport Layer Security &mdash; Home Networking 3 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Home Networking 3 documentation" href="index.html"/>
        <link rel="next" title="Nginx Server" href="nginx.html"/>
        <link rel="prev" title="Additional Software" href="server-tools.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Home Networking</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="server-tools.html">Additional Software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="server-tools.html#useful-tools">Useful Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="server-tools.html#provide-entropy">Provide Entropy</a></li>
<li class="toctree-l2"><a class="reference internal" href="server-tools.html#section-to-cross-reference">Section to cross-reference</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">TLS - Transport Layer Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#openssl-configuration">OpenSSL Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cacert-org">CAcert.org</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generation-of-keys-and-csrs">Generation of Keys and CSRs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#csr-for-multiple-domain-names">CSR for Multiple Domain-Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="#csr-with-wild-card-domain-names">CSR with Wild-Card Domain Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="#submit-certificate-request">Submit Certificate Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="#server-certificate-chains">Server Certificate Chains</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ocsp-stapling-certificate-chains">OCSP Stapling Certificate Chains</a></li>
<li class="toctree-l2"><a class="reference internal" href="#diffie-hellman-dh-key-exchanges-parameters">Diffie-Hellman (DH) Key Exchanges Parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="nginx.html">Nginx Server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="source-install.html">Install Nginx from Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Nginx Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="php.html">PHP in Nginx</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Home Networking</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>TLS - Transport Layer Security</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/tls.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="tls-transport-layer-security">
<h1>TLS - Transport Layer Security<a class="headerlink" href="#tls-transport-layer-security" title="Permalink to this headline">¶</a></h1>
<p>We use OpenSSL to generate TLS (Transport Layer Security) certificates and keys
(public and private keys).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Following are recommendations valid in April 2014, using OpenSSL 1.0.1f under
Ubuntu 14.04 LTS &#8216;Trusty Thar&#8217;.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Enough entropy for key generation and encryption. See <em class="xref std std-ref">_increase-entropy</em>.</p>
</div>
<div class="section" id="openssl-configuration">
<h2>OpenSSL Configuration<a class="headerlink" href="#openssl-configuration" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Alternatively generation and management of keys, certificate signing
requests and certificates can also be handled on a desktop system using
<a class="reference external" href="http://xca.sourceforge.net">xca</a>.</p>
</div>
<p>Default system wide OpenSSL configuration is in the file
<tt class="file docutils literal"><span class="pre">/etc/ssl/openssl.cnf</span></tt>. On a typical server it is mostly used for key
generation.</p>
<p>Documentation is available in the <em class="manpage">config(5)</em> man page.</p>
<p>OpenSSL on a server should behave as follows:</p>
<blockquote>
<div><ul class="simple">
<li>Generate RSA private keys with <strong>4096</strong> bits (default is 2048 bits).</li>
<li>Generate digital signatures using <strong>SHA-2</strong> as digest (default is SHA-1
digest).</li>
<li>Don&#8217;t encrypt private keys, as servers start and run without any users present
to answer password prompts.</li>
<li>3rd-party CAs like CAcert or StartSSL only use the CN (common name) and maybe
the SubjectAltNames of the submitted CSR. All other information is typically
discarded.</li>
</ul>
</div></blockquote>
<p>Open <tt class="file docutils literal"><span class="pre">/etc/ssl/opensssl.conf</span></tt> in your editor</p>
<p>Change the &#8220;[ req ]&#8221; section as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c">####################################################################</span>
<span class="o">[</span> req <span class="o">]</span>
<span class="nv">default_bits</span>            <span class="o">=</span> 4096
<span class="nv">default_keyfile</span>         <span class="o">=</span> <span class="nv">$ENV</span>::HOME/<span class="nv">$ENV</span>::CN.key.pem
<span class="nv">distinguished_name</span>      <span class="o">=</span> req_distinguished_name
<span class="c">#attributes             = req_attributes</span>
<span class="nv">x509_extensions</span> <span class="o">=</span> v3_ca <span class="c"># The extentions to add to the self signed cert</span>
<span class="c"># Passwords for private keys if not present they will be prompted for</span>
<span class="nv">input_password</span> <span class="o">=</span>
<span class="nv">output_password</span> <span class="o">=</span>
</pre></div>
</div>
<p>Change the &#8220;[ req_distinguished_name ]&#8221; section as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span> req_distinguished_name <span class="o">]</span>
<span class="nv">countryName</span>                     <span class="o">=</span> Country Name <span class="o">(</span>2 letter code<span class="o">)</span>
<span class="nv">countryName_default</span>             <span class="o">=</span> CH
<span class="nv">countryName_min</span>                 <span class="o">=</span> 2
<span class="nv">countryName_max</span>                 <span class="o">=</span> 2

<span class="nv">stateOrProvinceName</span>             <span class="o">=</span> State or Province Name <span class="o">(</span>full name<span class="o">)</span>
<span class="nv">stateOrProvinceName_default</span>     <span class="o">=</span> Zurich

<span class="nv">localityName</span>                    <span class="o">=</span> Locality Name <span class="o">(</span>eg, city<span class="o">)</span>
<span class="nv">localityName_default</span>            <span class="o">=</span> Zurich

<span class="nv">organizationName</span>                <span class="o">=</span> Organization Name <span class="o">(</span>eg, company<span class="o">)</span>
<span class="nv">organizationName_default</span>        <span class="o">=</span> alainwolf.net

<span class="nv">organizationalUnitName</span>          <span class="o">=</span> Organizational Unit Name <span class="o">(</span>eg, section<span class="o">)</span>
<span class="nv">organizationalUnitName_default</span>  <span class="o">=</span> Internet Services

<span class="nv">commonName</span>                      <span class="o">=</span> Common Name <span class="o">(</span>e.g. server FQDN or YOUR name<span class="o">)</span>
<span class="nv">commonName_max</span>                  <span class="o">=</span> 64
<span class="nv">commonName_default</span>              <span class="o">=</span> <span class="nv">$ENV</span>::CN

<span class="nv">emailAddress</span>                    <span class="o">=</span> Email Address
<span class="nv">emailAddress_max</span>                <span class="o">=</span> 64
<span class="nv">emailAddress_default</span>            <span class="o">=</span> hostmaster@<span class="nv">$ENV</span>::CN
</pre></div>
</div>
</div>
<div class="section" id="cacert-org">
<h2>CAcert.org<a class="headerlink" href="#cacert-org" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://www.cacert.org">CAcert</a> has been dropped from the Ubuntu built-in
list of trusted certificate authorities (CA) in February 2014.
Also the Debian project no longer includes CAcert root certificates, since it
started to use Mozilla&#8217;s list of trusted CA&#8217;s in March 2014.</p>
<p>Steps to re-include the CAcert root certificate in Ubuntu as trusted CA:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sudo mkdir -p /usr/share/ca-certificates/cacert.org
<span class="nv">$ </span><span class="nb">cd</span> /usr/share/ca-certificates/cacert.org
<span class="nv">$ </span>sudo wget http://www.cacert.org/certs/root.crt
<span class="nv">$ </span>sudo dpkg-reconfigure ca-certificates
</pre></div>
</div>
</div>
<div class="section" id="generation-of-keys-and-csrs">
<h2>Generation of Keys and CSRs<a class="headerlink" href="#generation-of-keys-and-csrs" title="Permalink to this headline">¶</a></h2>
<p>Create a private key:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CN</span><span class="o">=</span>example.com
<span class="nv">$ </span><span class="nb">cd</span> /etc/ssl
<span class="nv">$ </span>sudo openssl genrsa -nodes -out private/<span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.key.pem 4096
<span class="nv">$ </span>sudo chmod 600 private/<span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.key.pem
</pre></div>
</div>
<p>Create a certificate signing request (CSR):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CN</span><span class="o">=</span>example.com
<span class="nv">$ </span><span class="nb">cd</span> /etc/ssl
<span class="nv">$ </span>openssl req -out <span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.req.pem -new -key private/<span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.key.pem -sha2
</pre></div>
</div>
<p>Create key and CSR:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CN</span><span class="o">=</span>example.com
<span class="nv">$ </span><span class="nb">cd</span> /etc/ssl
<span class="nv">$ </span>openssl req -newkey rsa:4096 -nodes -sha2 <span class="se">\</span>
    -out <span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.req.pem
    -keyout private/<span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.key.pem
<span class="nv">$ </span>sudo chmod 600 private/<span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.key.pem
</pre></div>
</div>
<p>An alternative command which supplies subject fields on the command-line:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CN</span><span class="o">=</span>example.com
<span class="nv">$ </span><span class="nb">cd</span> /etc/ssl
<span class="nv">$ </span>openssl req -new -newkey rsa:4096 -nodes -sha2 <span class="se">\</span>
    -out alainwolf_ch.csr <span class="se">\</span>
    -keyout alainwolf_ch.key <span class="se">\</span>
    -subj <span class="s2">&quot;/C=CH/ST=Zurich/L=Zurich/O=My Company Name/CN=${CN}/emailAddress=webmaster@example.com&quot;</span>
<span class="nv">$ </span>sudo chmod 600 private/<span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.key.pem
</pre></div>
</div>
</div>
<div class="section" id="csr-for-multiple-domain-names">
<span id="csr-multiple-domains"></span><h2>CSR for Multiple Domain-Names<a class="headerlink" href="#csr-for-multiple-domain-names" title="Permalink to this headline">¶</a></h2>
<p>Most websites are reachable with and without &#8220;www&#8221; before the domain name.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You CA will only allow certificates containing <em>commonNames</em> and
<em>subjectAltNames</em> for domains you previously have validated with them.</p>
</div>
<p>Here is how to create certficate signing request for a server with multiple
domain names and/or virtual hosts:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CN</span><span class="o">=</span>example.com
<span class="nv">$ </span><span class="nb">cd</span> /etc/ssl
<span class="nv">$ </span>cp openssl.cnf <span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.conf
<span class="nv">$ </span>edit <span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.conf
</pre></div>
</div>
<p>Look for the section called &#8220;[ req ]&#8221; and add or uncomment the following line:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">req_extensions</span> <span class="o">=</span> v3_req
</pre></div>
</div>
<p>Look for the section called &#8220;[ v3_req ]&#8221; and add the following line:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">subjectAltName</span> <span class="o">=</span> @alt_names
</pre></div>
</div>
<p>Add all the required domain-names for the server as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>alt_names<span class="o">]</span>
DNS.0 <span class="o">=</span> commonName:copy
DNS.1 <span class="o">=</span> www.example.com
DNS.2 <span class="o">=</span> example.net
DNS.3 <span class="o">=</span> www.example.net
DNS.4 <span class="o">=</span> other-example.com
DNS.5 <span class="o">=</span> www.other-example.com
</pre></div>
</div>
<p>Save and close the file and create the CSR as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>openssl req -config <span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.conf -out <span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.req.pem -newkey rsa:4096 <span class="se">\</span>
    -keyout private/<span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.key.pem -nodes -sha2
<span class="nv">$ </span>sudo chmod 600 private/<span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.key.pem
</pre></div>
</div>
</div>
<div class="section" id="csr-with-wild-card-domain-names">
<h2>CSR with Wild-Card Domain Names<a class="headerlink" href="#csr-with-wild-card-domain-names" title="Permalink to this headline">¶</a></h2>
<p>Follow the procedure for <a class="reference internal" href="#csr-multiple-domains"><em>CSR for Multiple Domain-Names</em></a> above, but add wild-cards as
follows in the &#8220;[alt_names]&#8221; section:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>alt_names<span class="o">]</span>
DNS.0 <span class="o">=</span> commonName:copy
DNS.1 <span class="o">=</span> *.example.com
</pre></div>
</div>
</div>
<div class="section" id="submit-certificate-request">
<h2>Submit Certificate Request<a class="headerlink" href="#submit-certificate-request" title="Permalink to this headline">¶</a></h2>
<p>Copy the CSR to clipboard and paste it into the appropriate form on the website
of the certificate authority:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CN</span><span class="o">=</span>example.com
<span class="nv">$ </span><span class="nb">cd</span> /etc/ssl
<span class="nv">$ </span>cat <span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.req.pem
-----BEGIN CERTIFICATE REQUEST-----
...
-----END CERTIFICATE REQUEST-----
</pre></div>
</div>
<p>After signing, the certificate authority will either offer you a file-download
of the certificate or display its contents in PEM format.
Install the signed certificate:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CN</span><span class="o">=</span>example.com
<span class="nv">$ </span><span class="nb">cd</span> /etc/ssl
cat <span class="s">&lt;&lt; EOF &gt; certs/${CN}.cert.pem</span>
<span class="s">-----BEGIN CERTIFICATE-----</span>
<span class="s">...</span>
<span class="s">-----END CERTIFICATE-----</span>
<span class="s">EOF</span>
</pre></div>
</div>
</div>
<div class="section" id="server-certificate-chains">
<h2>Server Certificate Chains<a class="headerlink" href="#server-certificate-chains" title="Permalink to this headline">¶</a></h2>
<p>Certificates signed by <a class="reference external" href="https://startssl.com/">StartSSL</a> are signed by its
intermediary class 1 or class 2 server or client CA.</p>
<p>CAcert certificates may be signed be its intermediary &#8220;CAcert Class 3 Root&#8221;</p>
<p>Connecting TLS clients expect the server to send the certificates of any
intermediary CA along with its own server certificate during the handshake.</p>
<div class="highlight-bash"><div class="highlight"><pre>   ......................
   : Server Certificate :   &lt;--- Sent by Server
   ......................
             |
............................
: Intermediate Certificate :   &lt;--- Sent by Server
............................
             |
 ..........................
 : Trusted CA Certificate :   &lt;--- Present in Client/Browser Certificate Storge
 ..........................
</pre></div>
</div>
<p>On some servers (e.g. Nginx) this is achieved by providing a
certificate-chain-file instead of a certificate file.</p>
<p>The chain file has the following form:</p>
<div class="highlight-bash"><div class="highlight"><pre>-----BEGIN CERTIFICATE-----

..........................
:   Server Certificate   :
..........................

-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----

............................
: Intermediate Certificate :
............................

-----END CERTIFICATE-----
</pre></div>
</div>
<p>Here are the steps to generate such certificate-chain-files.</p>
<p>Download the intermediate CA certificates:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> /etc/ssl/
<span class="nv">$ </span>sudo wget -O certs/StartCom_Class_1_Server_CA.pem <span class="se">\</span>
    https://www.startssl.com/certs/class1/sha2/pem/sub.class1.server.sha2.ca.pem
<span class="nv">$ </span>sudo wget -O certs/StartCom_Class_2_Server_CA.pem <span class="se">\</span>
    https://www.startssl.com/certs/class2/sha2/pem/sub.class2.server.sha2.ca.pem
<span class="nv">$ </span>sudo wget -O certs/CAcert_Class_3_Root.pem <span class="se">\</span>
    http://www.cacert.org/certs/class3.crt
</pre></div>
</div>
<p>Assuming the certificate is for the domain &#8220;example.com&#8221; and our signed
certificate is present as <cite>/etc/ssl/certs/example.com.crt</cite>.</p>
<p>StartCom Class 1 Primary Intermediate Server CA:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CN</span><span class="o">=</span>example.com
<span class="nv">$ </span><span class="nb">cd</span> /etc/ssl/
<span class="nv">$ </span>sudo cat certs/<span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.crt <span class="se">\</span>
         certs/StartCom_Class_1_Server_CA.pem <span class="se">\</span>
    &gt; <span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.chained.crt
</pre></div>
</div>
<p>StartCom Class 2 Primary Intermediate Server CA:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CN</span><span class="o">=</span>example.com
<span class="nv">$ </span><span class="nb">cd</span> /etc/ssl/
<span class="nv">$ </span>sudo cat certs/<span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.crt <span class="se">\</span>
         certs/StartCom_Class_2_Server_CA.pem <span class="se">\</span>
    &gt; <span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.chained.crt
</pre></div>
</div>
<p>CAcert Class 3 Root:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CN</span><span class="o">=</span>example.com
<span class="nv">$ </span><span class="nb">cd</span> /etc/ssl/
<span class="nv">$ </span>sudo cat certs/<span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.crt <span class="se">\</span>
         certs/CAcert_Class_3_Root.pem <span class="se">\</span>
    &gt; <span class="k">${</span><span class="nv">CN</span><span class="k">}</span>.chained.crt
</pre></div>
</div>
</div>
<div class="section" id="ocsp-stapling-certificate-chains">
<h2>OCSP Stapling Certificate Chains<a class="headerlink" href="#ocsp-stapling-certificate-chains" title="Permalink to this headline">¶</a></h2>
<p>Something similar but the other way around is needed when a server is providing
OCSP responses on behalf of the client and sends them along its certificate
during handshake.</p>
<p>The server knows about his own certificate, but in order to properly get and
verify OCSP reponses, he needs to know about any intermediate CA up to and
including the top-level signing CA.</p>
<p>The OCSP stapling chain file has the following form:</p>
<div class="highlight-bash"><div class="highlight"><pre>-----BEGIN CERTIFICATE-----

..........................
:   Root CA Certificate  :
..........................

-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----

...............................
: Intermediate CA Certificate :
...............................

-----END CERTIFICATE-----
</pre></div>
</div>
<p>To create OCSP stapling chain files, do the following:</p>
<p>StartCom Class 1 Primary Intermediate Server CA:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> /etc/ssl/
<span class="nv">$ </span>cat certs/StartCom_Certification_Authority.pem <span class="se">\</span>
      certs/certs/StartCom_Class_1_Server_CA.pem <span class="se">\</span>
    &gt; StartCom_Class_1_Server.OCSP-chain.pem
</pre></div>
</div>
<p>StartCom Class 2 Primary Intermediate Server CA:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> /etc/ssl/
</pre></div>
</div>
<p>CAcert Class 3 Root:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> /etc/ssl/
</pre></div>
</div>
</div>
<div class="section" id="diffie-hellman-dh-key-exchanges-parameters">
<h2>Diffie-Hellman (DH) Key Exchanges Parameters<a class="headerlink" href="#diffie-hellman-dh-key-exchanges-parameters" title="Permalink to this headline">¶</a></h2>
<p>To use perfect forward secrecy, Diffie-Hellman parameters must be set up on the
server side, otherwise the relevant cipher suites will be silently ignored:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd</span> /etc/ssl
sudo mkdir dhparams
sudo openssl dhparam -out dhparams/dh_1024.pem 1024
sudo openssl dhparam -out dhparams/dh_1536.pem 1536
</pre></div>
</div>
<p><a class="reference external" href="https://bettercrypto.org">bettercrypto.org</a> and other sources advise against
generating these and instead using proven and properly checked ones and make
references to <span class="target" id="index-0"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc3526.html"><strong>RFC 3526</strong></a>.</p>
<p>Unfortunately neither source nor the RFC tells how to get them.</p>
<p>The bettercrypto.org
<a class="reference external" href="https://github.com/BetterCrypto/Applied-Crypto-Hardening">Git-Repository</a>
contains a directory with some files and a readme in the
<a class="reference external" href="https://github.com/BetterCrypto/Applied-Crypto-Hardening/tree/master/tools/dhparams">/tools/dhparams</a>
directory.</p>
<p>To get those pre-made dhparam files:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd</span> /etc/ssl
sudo mkdir -p dhparams
sudo wget -O dhparams/dh_2048.pem <span class="se">\</span>
    https://git.bettercrypto.org/ach-master.git/blob_plain/HEAD:/tools/dhparams/group14.pem
sudo wget -O dhparams/dh_3072.pem <span class="se">\</span>
    https://git.bettercrypto.org/ach-master.git/blob_plain/HEAD:/tools/dhparams/group15.pem
sudo wget -O dhparams/dh_4096.pem <span class="se">\</span>
    https://git.bettercrypto.org/ach-master.git/blob_plain/HEAD:/tools/dhparams/group16.pem
sudo wget -O dhparams/dh_6144.pem <span class="se">\</span>
    https://git.bettercrypto.org/ach-master.git/blob_plain/HEAD:/tools/dhparams/group17.pem
sudo wget -O dhparams/dh_8192.pem <span class="se">\</span>
    https://git.bettercrypto.org/ach-master.git/blob_plain/HEAD:/tools/dhparams/group18.pem
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="nginx.html" class="btn btn-neutral float-right" title="Nginx Server"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="server-tools.html" class="btn btn-neutral" title="Additional Software"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Alain Wolf.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>